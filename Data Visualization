install.packages("ggplot2")
library("ggplot2", lib.loc="/Library/Frameworks/R.framework/Versions/3.5/Resources/library")
install.packages(c("dbplyr", "RSQLite"))
install.packages("ggjoy")
#double check that you have these three boxed off on the right under packages 
library(dplyr)
library(dbplyr)
library(RSQLite)
library(ggjoy)
#connecting sql to R 
# the "~/Documents" is subject to change on each persons computer
con <- dbConnect(drv=RSQLite::SQLite(), "~/Documents/homeworkcs/fareboxdb.sqlite")

#checking db contents
dbListTables(con)
dbListFields(con, "farebox_data")

## list all tables
tables <- dbListTables(con)

##list all columns
columns <- dbListFields(con, "farebox_data")

## exclude sqlite_sequence (contains table information)
tables <- tables[tables != "sqlite_sequence"]

df <- vector("list", length = length(tables))

## create a data.frame for each table
for (i in seq(along=tables)) {
  df[[i]] <- dbGetQuery(conn=con, statement=paste("SELECT * FROM '", tables[[i]], "'", sep=""))
}

#making sure its a dataframe
#class(dbGetQuery(conn=con, statement=paste("SELECT * FROM '", tables[[1]], "'", sep="")))

#summary(df)

#creating dataframe

fbdata <- df[[1]]

summary(fbdata)

#creating dataframe

fbdata <- df[[1]]

summary(fbdata)

summary(fbdata$ratio)

#The unconditioned distribution of fare collection rates 
ggplot(data = fbdata, aes(x=ratio)) + geom_density() +
  ggtitle("distribution of fare collection rates")+
  labs(y="fare rate", x="system")

#Scatter plot showing fare collection rates versus rates for flat rate systems 
ggplot(data = fbdata, aes(y=fare_system, x=fare_rate, colour=fare_system)) + 
  geom_point(alpha = 1) +
  ggtitle("fare collection vs flat rate systems")+
  labs(y="flat rate ", x = "fare rate ")

#Create a "joy plot" of the distribution of fare collection rates by fare system
ggplot(fbdata, aes(x =ratio, y = fare_system , fill = fare_system))+ 
  geom_joy(scale=1.5, rel_min_height=.01, alpha = 0.7) + 
  scale_y_discrete(expand = c(0.01, 0)) +
  labs(x = "Fare box ratio", y= "Fare System" , title = "Fare ratio by fare system")
theme_joy() + scale_fill_discrete(guide=FALSE)

#Create a "joy plot" of the distribution of fare collection rates by continent 
ggplot(fbdata, aes(x =fare_rate, y = continent, fill = continent))+ 
  geom_joy(scale=1.5, rel_min_height=.01, alpha = 0.7) + 
  scale_y_discrete(expand = c(0.01, 0)) +
  labs(x = "Fare Rate", y= "Continent" , title = "Fare Collection Rates by Continent")
theme_joy() + scale_fill_discrete(guide=FALSE)
